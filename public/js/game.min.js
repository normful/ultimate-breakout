(function(){var e={preload:J,create:Q,update:Va};var a=new Phaser.Game(o,r,Phaser.AUTO,"breakout",e);var o=800;var r=600;var t=false;var i;var n;var l;var d;var s=4;var c=15;var y=120;var u=100;var f=36;var p=52;var b=[];var v=new Date;var _;var h;var m=500;var k=48;var g;var x;var M;var P;var w=true;var T=16;var A=16;var S=-75;var I=-300;var B=8;var D=1.1;var O=0;var C=3;var R;var X;var L;var W=550;var E;var V;var G;var F;var K={};var Y=$("#leaderboard-table-body");var Z=$("#high-scores");var H=$(".game-over-dialog");var U;var N;var j;var z;var q;function J(){a.load.atlas("breakout","/assets/breakout.png","/assets/breakout.json");a.load.image("blackStarfield","/assets/black_starfield.png");a.load.audio("sfx","assets/audio/breakout.mp3")}function Q(){a.stage.disableVisibilityChange=true;a.physics.startSystem(Phaser.Physics.ARCADE);n=a.add.tileSprite(0,0,800,600,"blackStarfield");a.physics.arcade.checkCollision.down=false;ta();ea();aa();oa();ra();na();la();da();ya();ua();fa();a.input.onDown.add(Na,e);ha();setTimeout(bo,500);E=io.connect(window.location.hostname);ma();$("#breakout").on("mousemove",function o(){E.emit("update paddle position",{x:a.input.x-.5*k})});window.addEventListener("focus",va,false);window.addEventListener("blur",_a,false)}function ea(){l=a.add.group();l.enableBody=true;l.physicsBodyType=Phaser.Physics.ARCADE;var e;var o=0;for(var r=0;r<s;r++){for(var t=0;t<c;t++){e=l.create(y+t*f,u+r*p,"breakout","brick_"+(r+1)+"_1.png");e.body.bounce.set(1);e.body.immovable=true;e.brickIndex=o++}}}function aa(){d=a.add.emitter(0,0,500);d.makeParticles("breakout","brick_chunk.png");d.gravity=500}function oa(){_=a.add.group();_.enableBody=true;_.physicsBodyType=Phaser.Physics.ARCADE}function ra(){h=a.add.sprite(a.world.centerX,m,"breakout","paddle_big.png");h.anchor.setTo(.5,.5);a.physics.enable(h,Phaser.Physics.ARCADE);h.body.collideWorldBounds=true;h.body.bounce.set(1);h.body.immovable=true}function ta(){g=a.add.group();g.enableBody=true;g.physicsBodyType=Phaser.Physics.ARCADE}function ia(e){var o=e.id;var r;if(typeof K[o].paddle==="object"){return}r=g.create(a.world.centerX,m,"breakout","paddle_big.png");r.anchor.setTo(.5,.5);a.physics.enable(r,Phaser.Physics.ARCADE);r.body.collideWorldBounds=true;r.body.bounce.set(1);r.body.immovable=true;r.name=o;r.tint=e.color;r.blendMode=PIXI.blendModes.ADD;r.alpha=.7;K[o].paddle=r}function na(){x=a.add.sprite(a.world.centerX,m-A,"breakout","ball.png");x.anchor.set(.5);x.checkWorldBounds=true;a.physics.enable(x,Phaser.Physics.ARCADE);x.body.collideWorldBounds=true;x.body.bounce.set(1);x.events.onOutOfBounds.add(ja,this)}function la(){M=a.add.emitter(x.body.x,x.body.y,200);M.makeParticles("breakout","blue_glow.png");M.gravity=200;M.autoAlpha=true;M.maxParticleAlpha=.31;M.minParticleAlpha=.3}function da(){P=a.add.emitter(x.body.x,x.body.y,200);P.makeParticles("breakout","green_glow.png");P.gravity=-200;P.autoAlpha=true;P.maxParticleAlpha=.31;P.minParticleAlpha=.3}function sa(e){if(typeof K[e.id]!=="undefined"){if(typeof K[e.id].remotePlayerBall!=="undefined"){K[e.id].remotePlayerBall.x=e.x;K[e.id].remotePlayerBall.y=e.y}}}function ca(e){if(typeof K[e.remotePlayerID]!=="undefined"){if(K[e.remotePlayerID].gameOver===true){return}}var o=a.add.sprite(e.posX,e.posY,"breakout","ball.png");o.anchor.set(.5);o.checkWorldBounds=true;a.physics.enable(o,Phaser.Physics.ARCADE);o.body.collideWorldBounds=true;o.body.bounce.set(1);o.body.velocity.x=e.velocityX;o.body.velocity.y=e.velocityY;o.tint=K[e.remotePlayerID].color;o.blendMode=PIXI.blendModes.ADD;o.alpha=.7;K[e.remotePlayerID].remotePlayerBall=o}function ya(){R=a.add.text(32,W,"score: "+O,{font:"20px VT323",fill:"#ffffff",align:"left"});X=a.add.text(o-120,W,"lives: "+C,{font:"20px VT323",fill:"#ffffff",align:"left"});L=a.add.text(a.world.centerX,r*(2/3),"Click to Start",{font:"40px VT323",fill:"#ffffff",align:"center"});L.anchor.setTo(.5,.5)}function ua(){i=a.add.audio("sfx");i.addMarker("SM64_Power_Star_Appears",0,5);i.addMarker("powerUp",5,3);i.addMarker("gameOver",8,4);i.addMarker("c",12,3);i.addMarker("cHigh",15,3);i.addMarker("e",18,3);i.addMarker("g",21,3);i.addMarker("gLow",24,3);i.addMarker("monsterKill",27,4.5);i.addMarker("counterTerroristsWin",32,2.5);i.addMarker("Mario_Kart_64_Luigi_Mamma_Mia",35,2);i.addMarker("firstBlood",37.5,2);i.addMarker("terroristsWin",40,2);i.addMarker("outstanding",42,2);i.addMarker("Gears_Of_War_Marcus_Nice_Throw",44,2);i.addMarker("slammin",46,2);i.addMarker("StarCraft_Fenix_Zealot_For_Aiur",48,2);i.addMarker("oneUp",50,1);i.addMarker("Gears_Of_War_Marcus_Ill_Take_This",52,2);i.addMarker("The_Legend_of_Zelda_Get_Item",54,1);i.addMarker("SFIV_Ken_Hadouken",56,1);i.addMarker("SFIV_Ryu_Shoryuken",58,1);i.addMarker("The_Legend_of_Zelda_Get_Rupee",60,1)}function fa(){H.dialog({dialogClass:"no-close",draggable:false,autoOpen:false,show:{effect:"fade",duration:1e3},position:{of:"#breakout"}});U=H.find("span.final-score");N=H.find("h2.name");j=H.find("input.name");j.bind("enterKey",function(){pa()});j.keyup(function(e){if(e.keyCode===13){j.trigger("enterKey")}});z=H.find("input.save-score");z.on("click",pa);q=H.find("input.play-again");q.on("click",va)}function pa(){E.emit("player final score",{name:j.val(),score:O});ba()}function ba(){N.text("SCORE SAVED");j.remove();z.remove()}function va(){location.reload()}function _a(){E.io.disconnect()}function ha(){$(function(){Y.mixItUp({selectors:{target:"tr"},layout:{display:"table-row"}})})}function ma(){E.on("connect",Sa);E.on("disconnect",Ia);E.on("new player",Ba);E.on("local player",Da);E.on("remove player",Ca);E.on("update paddle position",yo);E.on("initial bricks",Ra);E.on("brick kill to other clients",Xa);E.on("paddle release ball",Aa);E.on("ball hit paddle",Ta);E.on("existing ball",wa);E.on("kill remote ball",Pa);E.on("update ball",sa);E.on("update local score",La);E.on("update remote score",Wa);E.on("remote player game over",fo);E.on("play brick hit sound",ka);E.on("first brick hit",ga);E.on("render plus 500",xa);E.on("render plus 1000",Ma);E.on("play monster kill sound",no);E.on("play last brick sound",lo);E.on("high scores",po)}function ka(e){if(e.sound===0){i.play("c")}else if(e.sound===1){i.play("e")}else if(e.sound===2){i.play("g")}else{i.play("cHigh")}}function ga(){i.play("firstBlood")}function xa(e){Fa(e.x,e.y,"breakout","plus_500.png")}function Ma(e){Fa(e.x,e.y,"breakout","plus_1000.png")}function Pa(e){var a;var o;a=K[e.remotePlayerID];if(typeof a!=="undefined"){o=a.remotePlayerBall}if(typeof o!=="undefined"){o.kill()}}function wa(e){if(typeof K[e.remotePlayerID]!=="undefined"&&typeof K[e.remotePlayerID].remotePlayerBall==="undefined"){ca(e)}}function Ta(e){var a=K[e.remotePlayerID];var o;if(typeof a!=="undefined"){o=a.remotePlayerBall}if(typeof o!=="undefined"){o.body.velocity.x=e.exitVelocityX;o.body.velocity.y=e.exitVelocityY}}function Aa(e){ca(e)}function Sa(){E.emit("new player",{existingBricks:co(l)})}function Ia(){}function Ba(e){K[e.id]={name:e.name,score:e.score,color:e.color,gameOver:e.gameOver,paddleX:a.world.centerX};Oa(e);ia(e);if(!w){E.emit("existing ball",{velocityX:x.body.velocity.x,velocityY:x.body.velocity.y,posX:x.body.position.x,posY:x.body.position.y})}}function Da(e){G=e.id;V=e.name;F=e.color;Oa(e);h.tint=F;x.tint=F}function Oa(e){var a;var o="#"+vo(e.color.substring(2),6);var r;var t;var i;var n;if(e.hasOwnProperty("score")){a=e.score}else{a=O;e.name+=" (You)"}n=$("<span></span>");n.css({background:o,height:"15px",width:"15px",display:"inline-block","margin-right":"5px","border-radius":"50%"});r=$("<tr></tr>");r.attr("data-score",a);r.attr("data-id",e.id);t=$("<td></td>").text(a);i=$("<td></td>").text(e.name);r.append(t).append(i).appendTo(Y);i.prepend(n)}function Ca(e){if(typeof K[e.id]!=="undefined"){var a=K[e.id].remotePlayerBall;if(typeof a!=="undefined"){a.kill()}var o=K[e.id].paddle;if(typeof o!=="undefined"){o.kill()}}var r={};for(var t in K){if(t!==e.id){r[t]=K[t]}}K=r}function Ra(e){var a;for(var o=0;o<s;o++){for(var r=0;r<c;r++){a=o*c+r;if(e.initialBricks.charAt(a)==="0"){l.children[a].kill()}}}}function Xa(e){l.children[e.brickIndex].kill();var a;var o;a=K[e.remotePlayerID];if(typeof a!=="undefined"){o=a.remotePlayerBall}if(typeof o!=="undefined"){o.body.velocity.x=e.exitVelocityX;o.body.velocity.y=e.exitVelocityY}}function La(e){O=e.score;R.text="score: "+O;Ea(e)}function Wa(e){if(typeof K[e.id]!=="undefined"){K[e.id].score=e.score;Ea(e)}}function Ea(e){var a=Y.find("[data-id='"+e.id+"']");a.attr("data-score",e.score);var o=a.children().first();o.text(e.score);Y.mixItUp("sort","score:desc")}function Va(){if(!t){t=true}E.emit("update ball",{x:x.body.x,y:x.body.y});h.body.x=a.input.x-.5*k;if(h.body.x<0){h.body.x=0}else if(h.body.x>a.width-k){h.body.x=a.width-k}if(w){x.body.x=h.body.x+.5*k-.5*T}else{a.physics.arcade.collide(x,h,so,null,e);a.physics.arcade.collide(x,l,eo,null,e)}if(l.countLiving()===0){qa()}if(!$.isEmptyObject(K)){uo()}a.physics.arcade.collide(d);a.physics.arcade.collide(h,_,Ga,null,e);M.x=x.body.x;M.y=x.body.y;P.x=x.body.x;P.y=x.body.y}function Ga(e,a){a.kill();if(H.dialog("isOpen")){return}if(a.type==="extraLife"){$a();i.play("oneUp")}else if(a.type==="increaseSpeed"){Ya();setTimeout(Za,5e3);P.start(false,100,15);setTimeout(Ua,5e3);i.play("powerUp")}else if(a.type==="decreaseSpeed"){Za();setTimeout(Ya,5e3);M.start(false,120,30);setTimeout(Ha,5e3);i.play("powerUp")}else if(a.type==="gowMarcusIllTakeThis"){Ka();Fa(e.x,m,"breakout","plus_500.png");i.play("Gears_Of_War_Marcus_Ill_Take_This")}else if(a.type==="gowMarcusNiceThrow"){Ka();Fa(e.x,m,"breakout","plus_500.png");i.play("Gears_Of_War_Marcus_Nice_Throw")}else if(a.type==="mk64Luigi"){Ka();Fa(e.x,m,"breakout","plus_500.png");i.play("Mario_Kart_64_Luigi_Mamma_Mia")}else if(a.type==="kenHadouken"){Ka();Fa(e.x,m,"breakout","plus_500.png");i.play("SFIV_Ken_Hadouken")}else if(a.type==="ryuShoruken"){Ka();Fa(e.x,m,"breakout","plus_500.png");i.play("SFIV_Ryu_Shoryuken")}else if(a.type==="sm64PowerStar"){Ka();Fa(e.x,m,"breakout","plus_500.png");i.play("SM64_Power_Star_Appears")}else if(a.type==="starcraftZeolot"){Ka();Fa(e.x,m,"breakout","plus_500.png");i.play("StarCraft_Fenix_Zealot_For_Aiur")}else if(a.type==="zeldaItem"){Ka();Fa(e.x,m,"breakout","plus_500.png");i.play("The_Legend_of_Zelda_Get_Item")}else if(a.type==="zeldaRupee"){Ka();Fa(e.x,m,"breakout","plus_500.png");i.play("The_Legend_of_Zelda_Get_Rupee")}}function $a(){if(H.dialog("isOpen")){return}C++;X.text="lives: "+C;Fa(h.body.x,m,"breakout","one_up.png")}function Fa(e,o,r,t){var i=a.add.sprite(e,o,r,t);i.enableBody=true;a.physics.enable(i,Phaser.Physics.ARCADE);i.body.velocity.y=-100;i.lifespan=2e3;a.add.tween(i).delay(500).to({alpha:0},1500).start()}function Ka(){E.emit("plus 500 points")}function Ya(){x.body.velocity.x*=D;x.body.velocity.y*=D;S*=D;I*=D;B*=D}function Za(){x.body.velocity.x/=D;x.body.velocity.y/=D;S/=D;I/=D;B/=D}function Ha(){M.on=false}function Ua(){P.on=false}function Na(){if(w){w=false;x.body.velocity.x=S*(Math.random()*4-1);x.body.velocity.y=I;L.visible=false;E.emit("paddle release ball",{velocityX:x.body.velocity.x,velocityY:x.body.velocity.y,posX:x.body.x,posY:x.body.y})}}function ja(){E.emit("kill remote ball");C--;X.text="lives: "+C;if(C===0){Ja()}else{za()}}function za(){w=true;x.reset(h.body.x+.5*k-.5*T,m-A)}function qa(){E.emit("kill remote ball");l.callAll("revive");if(C!==0){za();L.text="Next Round"}}function Ja(){i.play("gameOver");x.body.velocity.setTo(0,0);E.emit("player game over");Qa()}function Qa(){H.dialog("open");j.val(V);j.select();U.text(O)}function eo(e,a){ao(a.y);E.emit("brick kill from client",{brickIndex:a.brickIndex,brickX:a.x,brickY:a.y,velocityX:x.body.velocity.x,velocityY:x.body.velocity.y});var o=Math.random();if(o>0&&o<.02){ro("extraLife","extra_life.png",a.x,a.y)}else if(o>.1&&o<.15){ro("increaseSpeed","increase_speed.png",a.x,a.y)}else if(o>.15&&o<.2){ro("decreaseSpeed","decrease_speed.png",a.x,a.y)}else if(o>.2&&o<.21){ro("gowMarcusIllTakeThis","Gears_Of_War_Marcus_Ill_Take_This.png",a.x,a.y)}else if(o>.21&&o<.22){ro("gowMarcusNiceThrow","Gears_Of_War_Marcus_Nice_Throw.png",a.x,a.y)}else if(o>.22&&o<.23){ro("mk64Luigi","Mario_Kart_64_Luigi_Mamma_Mia.png",a.x,a.y)}else if(o>.23&&o<.24){ro("kenHadouken","SFIV_Ken_Hadouken.png",a.x,a.y)}else if(o>.24&&o<.25){ro("ryuShoruken","SFIV_Ryu_Shoryuken.png",a.x,a.y)}else if(o>.25&&o<.26){ro("sm64PowerStar","SM64_Power_Star_Appears.png",a.x,a.y)}else if(o>.26&&o<.27){ro("starcraftZeolot","StarCraft_Fenix_Zealot_For_Aiur.png",a.x,a.y)}else if(o>.27&&o<.28){ro("zeldaItem","The_Legend_of_Zelda_Get_Item.png",a.x,a.y)}else if(o>.28&&o<.29){ro("zeldaRupee","The_Legend_of_Zelda_Get_Rupee.png",a.x,a.y)}oo(a);a.kill();b.push(new Date);to()}function ao(e){if(e===100){i.play("cHigh");E.emit("play brick hit sound",{sound:3})}else if(e===152){i.play("g");E.emit("play brick hit sound",{sound:2})}else if(e===204){i.play("e");E.emit("play brick hit sound",{sound:1})}else{i.play("c");E.emit("play brick hit sound",{sound:0})}}function oo(e){d.x=e.x;d.y=e.y;d.start(true,2e3,null,Math.floor(Math.random()*10)+5)}function ro(e,o,r,t){var i=_.create(r,t,"breakout",o);i.type=e;i.anchor.setTo(.5,.5);i.checkWorldBounds=true;i.outOfBoundsKill=true;a.physics.enable(i,Phaser.Physics.ARCADE);i.body.velocity.y=100}function to(){var e=b.length;if(e<6){return}var a=b[e-1]-b[e-6];if(a<550&&new Date-v>1e4){i.play("monsterKill");v=new Date;Fa(x.body.x,x.body.y,"breakout","plus_1000.png");E.emit("monster kill")}}function no(){i.play("monsterKill")}function lo(e){var a=Math.floor(e.randSoundNum*4);if(a===0){i.play("counterTerroristsWin")}else if(a===1){i.play("terroristsWin")}else if(a===2){i.play("slammin")}else if(a===3){i.play("outstanding")}}function so(e,a){i.play("gLow");var o=e.body.x+T/2;var r=a.body.x+k/2;var t;if(o<r){t=r-o;e.body.velocity.x=B*t*-1}else if(o>r){t=o-r;e.body.velocity.x=B*t}else{e.body.velocity.x=B*.2+Math.random()*B*.8}E.emit("ball hit paddle",{velocityX:e.body.velocity.x,velocityY:e.body.velocity.y})}function co(e){var a;var o=e.children.length;var r="";for(a=0;a<o;a++){if(e.children[a].alive){r+="1"}else{r+="0"}}return r}function yo(e){if(typeof K[e.id]!=="undefined"){K[e.id].paddleX=e.x}}function uo(){$.each(K,function(e,a){if(typeof a.paddle!=="undefined"){a.paddle.body.x=a.paddleX}})}function fo(e){if(typeof K[e.id]!=="undefined"){K[e.id].gameOver=true}}function po(e){Z.empty();Z.append("HIGH SCORES: ");$.each(e.scores,function(e,a){var o=a.score.toString();var r=(e+1).toString();var t=$("<span></span>").addClass("top-score").text(r+". "+a.name+" ("+o+") ");Z.append(t)})}function bo(){if(!t){va()}}function vo(e,a){e=e+"";return e.length>=a?e:new Array(a-e.length+1).join(0)+e}})();